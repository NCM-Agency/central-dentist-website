---
// TestimonialsCarousel.astro - Testimonials carousel section
export interface Props {
  testimonials: Array<{
    content: string;
    author: string;
    rating?: number;
    verified?: boolean;
  }>;
  title?: string;
  class?: string;
}

const { 
  testimonials,
  title = "Testimonials",
  class: className = ''
} = Astro.props;
---

<section class={`section-padding bg-gray-light ${className}`} data-gjs-type="testimonials">
  <div class="container mx-auto container-padding">
    <h2 class="text-4xl md:text-5xl font-normal text-teal-dark text-center mb-12" style="font-family: 'Playfair Display', serif;">{title}</h2>
    
    <div class="relative max-w-4xl mx-auto">
      <!-- Carousel Container -->
      <div class="testimonials-carousel overflow-hidden">
        <div class="testimonials-track flex transition-transform duration-500 ease-in-out">
          {testimonials.map((testimonial, index) => (
            <div class="testimonial-slide w-full flex-shrink-0 px-4" data-index={index}>
              <div class="bg-white rounded-2xl shadow-lg p-8 md:p-10 min-h-[320px] flex flex-col">
                <!-- Quote Icon -->
                <div class="mb-6">
                  <svg class="w-12 h-12 text-teal opacity-50" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
                  </svg>
                </div>
                
                <!-- Testimonial Content -->
                <blockquote class="mb-6">
                  <p class="font-body text-lg text-gray-dark leading-relaxed italic">
                    "{testimonial.content}"
                  </p>
                </blockquote>
                
                <!-- Author & Rating -->
                <div class="flex items-center justify-between">
                  <div class="flex items-center">
                    <div>
                      <p class="font-heading font-semibold text-gray-dark">
                        â€” {testimonial.author}
                      </p>
                      {testimonial.verified && (
                        <p class="text-sm text-teal flex items-center mt-1">
                          <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                          </svg>
                          Verified Patient
                        </p>
                      )}
                    </div>
                  </div>
                  
                  {testimonial.rating && (
                    <div class="flex space-x-1">
                      {[...Array(5)].map((_, i) => (
                        <svg 
                          class={`w-5 h-5 ${i < testimonial.rating ? 'text-yellow-400' : 'text-gray-300'}`} 
                          fill="currentColor" 
                          viewBox="0 0 20 20"
                        >
                          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
      
      <!-- Navigation Buttons -->
      <button 
        class="testimonial-prev absolute left-0 top-1/2 -translate-y-1/2 -translate-x-12 bg-white rounded-full p-3 shadow-lg hover:shadow-xl transition-all hover:scale-110 focus:outline-none focus:ring-2 focus:ring-teal"
        aria-label="Previous testimonial"
      >
        <svg class="w-6 h-6 text-teal" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      </button>
      
      <button 
        class="testimonial-next absolute right-0 top-1/2 -translate-y-1/2 translate-x-12 bg-white rounded-full p-3 shadow-lg hover:shadow-xl transition-all hover:scale-110 focus:outline-none focus:ring-2 focus:ring-teal"
        aria-label="Next testimonial"
      >
        <svg class="w-6 h-6 text-teal" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </button>
      
      <!-- Dots Navigation -->
      <div class="flex justify-center mt-8 space-x-2">
        {testimonials.map((_, index) => (
          <button 
            class={`testimonial-dot w-3 h-3 rounded-full transition-all ${index === 0 ? 'bg-teal w-8' : 'bg-gray-300 hover:bg-gray-400'}`}
            data-index={index}
            aria-label={`Go to testimonial ${index + 1}`}
          />
        ))}
      </div>
    </div>
    
    <!-- View More Link -->
    <div class="text-center mt-12">
      <a
        href="/reviews-testimonials" 
        class="inline-flex items-center text-teal hover:text-teal-dark font-semibold transition-colors"
      >
        <span>More Patient Reviews</span>
        <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
        </svg>
      </a>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.querySelector('.testimonials-carousel');
    const track = document.querySelector('.testimonials-track');
    const slides = document.querySelectorAll('.testimonial-slide');
    const prevBtn = document.querySelector('.testimonial-prev');
    const nextBtn = document.querySelector('.testimonial-next');
    const dots = document.querySelectorAll('.testimonial-dot');
    
    let currentIndex = 0;
    const totalSlides = slides.length;
    
    // Update carousel position
    function updateCarousel() {
      const offset = -currentIndex * 100;
      track.style.transform = `translateX(${offset}%)`;
      
      // Update dots
      dots.forEach((dot, index) => {
        if (index === currentIndex) {
          dot.classList.add('bg-teal', 'w-8');
          dot.classList.remove('bg-gray-300');
        } else {
          dot.classList.remove('bg-teal', 'w-8');
          dot.classList.add('bg-gray-300');
        }
      });
    }
    
    // Next button
    nextBtn?.addEventListener('click', () => {
      currentIndex = (currentIndex + 1) % totalSlides;
      updateCarousel();
    });
    
    // Previous button
    prevBtn?.addEventListener('click', () => {
      currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
      updateCarousel();
    });
    
    // Dots navigation
    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => {
        currentIndex = index;
        updateCarousel();
      });
    });
    
    // Auto-play
    let autoPlayInterval = setInterval(() => {
      currentIndex = (currentIndex + 1) % totalSlides;
      updateCarousel();
    }, 5000);
    
    // Pause on hover
    carousel?.addEventListener('mouseenter', () => {
      clearInterval(autoPlayInterval);
    });
    
    carousel?.addEventListener('mouseleave', () => {
      autoPlayInterval = setInterval(() => {
        currentIndex = (currentIndex + 1) % totalSlides;
        updateCarousel();
      }, 5000);
    });
    
    // Touch support for mobile
    let startX = 0;
    let isDragging = false;
    
    carousel?.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
      isDragging = true;
    });
    
    carousel?.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      e.preventDefault();
    });
    
    carousel?.addEventListener('touchend', (e) => {
      if (!isDragging) return;
      
      const endX = e.changedTouches[0].clientX;
      const diff = startX - endX;
      
      if (Math.abs(diff) > 50) {
        if (diff > 0) {
          // Swipe left - next
          currentIndex = (currentIndex + 1) % totalSlides;
        } else {
          // Swipe right - previous
          currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
        }
        updateCarousel();
      }
      
      isDragging = false;
    });
  });
</script>

<style>
  @media (max-width: 768px) {
    .testimonial-prev,
    .testimonial-next {
      display: none;
    }
  }
</style>